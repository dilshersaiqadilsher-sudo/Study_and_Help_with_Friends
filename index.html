<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>StudyBuddy AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- âœ… PWA REQUIRED -->
<link rel="manifest" href="./manifest.json">
<meta name="description" content="StudyBuddy AI helps students with chat, math, study, and Islamic learning.">
<meta name="application-name" content="StudyBuddy AI">
<meta name="theme-color" content="#0b1225">

<link rel="icon" href="./icon-192.png">
<link rel="apple-touch-icon" href="./icon-192.png">
<meta name="apple-mobile-web-app-capable" content="yes">

<style>
:root{
  --bg:#0b1225;
  --card:#111a33;
  --user:#2563eb;
  --bot:#1f2937;
  --text:#ffffff;
}
.light{
  --bg:#f3f4f6;
  --card:#ffffff;
  --user:#2563eb;
  --bot:#e5e7eb;
  --text:#000000;
}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Arial,Helvetica,sans-serif;
  display:flex;
  justify-content:center;
}
.app{
  width:420px;
  max-width:100%;
  height:100vh;
  display:flex;
  flex-direction:column;
}
.top,.mode-bar{
  padding:8px;
  display:flex;
  gap:6px;
}
.top button,.mode-bar button{
  flex:1;
  padding:8px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
.chat{
  flex:1;
  overflow-y:auto;
  padding:10px;
}
.msg{
  margin:6px 0;
  padding:10px 14px;
  border-radius:14px;
  max-width:85%;
  white-space:pre-wrap;
}
.user{
  background:var(--user);
  align-self:flex-end;
}
.bot{
  background:var(--bot);
  align-self:flex-start;
}
.bottom{
  display:flex;
  gap:6px;
  padding:10px;
}
.bottom input{
  flex:1;
  padding:10px;
  border-radius:10px;
  border:none;
}
.bottom button{
  padding:10px 14px;
  border:none;
  border-radius:10px;
  background:#22c55e;
  cursor:pointer;
}
</style>
</head>

<body>
<div class="app">

<div class="top">
  <button onclick="toggleTheme()">ðŸŒ— Theme</button>
  <button onclick="exportChat()">â¬‡ Export</button>
  <button onclick="logout()">ðŸšª Logout</button>
</div>

<div class="mode-bar">
  <button onclick="setMode('chat')">ðŸ’¬ Chat</button>
  <button onclick="setMode('math')">âž— Math</button>
  <button onclick="setMode('study')">ðŸ“˜ Study</button>
  <button onclick="setMode('islam')">ðŸ•Œ Islamic</button>
</div>

<div class="chat" id="chat"></div>

<div class="bottom">
  <input id="input" placeholder="Ask something..." onkeydown="if(event.key==='Enter')send()">
  <button onclick="send()">â–¶</button>
</div>

</div>

<script>
let mode="chat";
let chatLog=[];
const chat=document.getElementById("chat");

function add(text,cls){
  const d=document.createElement("div");
  d.className="msg "+cls;
  d.innerText=text;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
  chatLog.push((cls==="user"?"User: ":"AI: ")+text);
}

function setMode(m){
  mode=m;
  add("Mode switched to "+m.toUpperCase(),"bot");
}

function send(){
  const i=document.getElementById("input");
  const t=i.value.trim();
  if(!t) return;
  i.value="";
  add(t,"user");

  if(mode==="math") solveMath(t);
  else if(mode==="study") study(t);
  else if(mode==="islam") islam(t);
  else chatAI(t);
}

/* ===== MATH ===== */
function solveMath(q){
  try{
    if(!/^[0-9+\-*/().\s]+$/.test(q)){
      add("Please enter a valid math expression.","bot");
      return;
    }
    add("Answer: "+Function("return "+q)(),"bot");
  }catch{
    add("Math error.","bot");
  }
}

/* ===== CHAT ===== */
function chatAI(q){
  q=q.toLowerCase();
  if(q.includes("hi")||q.includes("hello"))
    add("Hello! ðŸ˜Š How can I help you today?","bot");
  else if(q.includes("how are you"))
    add("I am doing great! Thanks for asking ðŸ˜Š","bot");
  else if(q.includes("who are you"))
    add("I am your StudyBuddy AI, designed to help, teach, and chat with you.","bot");
  else if(q.includes("who made you"))
    add("I was made by a young Muslim developer to help students learn and grow ðŸŒŸ","bot");
  else if(q.includes("what can you do"))
    add("I can chat, solve math, help with studies, and support Islamic learning.","bot");
  else if(q.includes("bye"))
    add("Goodbye! ðŸ‘‹ Come back anytime.","bot");
  else
    add("That's interesting ðŸ¤” Tell me more!","bot");
}

/* ===== STUDY ===== */
function study(q){
  q=q.toLowerCase();
  if(q.includes("english"))
    add("English is a global language used for communication worldwide.","bot");
  else if(q.includes("urdu"))
    add("Urdu is the national language of Pakistan.","bot");
  else if(q.includes("science"))
    add("Science studies nature, experiments, and discoveries.","bot");
  else if(q.includes("history"))
    add("History studies past events and civilizations.","bot");
  else if(q.includes("geography"))
    add("Geography studies Earth, land, climate, and maps.","bot");
  else
    add("Please ask a study topic like science, history, geography, English, or Urdu.","bot");
}

/* ===== ISLAMIC ===== */
function islam(q){
  q=q.toLowerCase();
  if(q==="quran"){
    add("ðŸ“– Quran is the holy book of Allah.\nType:\nâ€¢ Surah Fatiha\nâ€¢ Surah Ikhlas\nâ€¢ Surah Nas\nâ€¢ Hifz help","bot");
  }
  else if(q.includes("surah fatiha")){
    add("Ø¨ÙØ³Ù’Ù…Ù Ø§Ù„Ù„Ù‘ÙŽÙ‡Ù Ø§Ù„Ø±Ù‘ÙŽØ­Ù’Ù…ÙŽÙ°Ù†Ù Ø§Ù„Ø±Ù‘ÙŽØ­ÙÙŠÙ…Ù\n\nØ§Ù„Ù’Ø­ÙŽÙ…Ù’Ø¯Ù Ù„ÙÙ„Ù‘ÙŽÙ‡Ù Ø±ÙŽØ¨Ù‘Ù Ø§Ù„Ù’Ø¹ÙŽØ§Ù„ÙŽÙ…ÙÙŠÙ†ÙŽ\nØ§Ù„Ø±Ù‘ÙŽØ­Ù’Ù…ÙŽÙ°Ù†Ù Ø§Ù„Ø±Ù‘ÙŽØ­ÙÙŠÙ…Ù\nÙ…ÙŽØ§Ù„ÙÙƒÙ ÙŠÙŽÙˆÙ’Ù…Ù Ø§Ù„Ø¯Ù‘ÙÙŠÙ†Ù\nØ¥ÙÙŠÙ‘ÙŽØ§ÙƒÙŽ Ù†ÙŽØ¹Ù’Ø¨ÙØ¯Ù ÙˆÙŽØ¥ÙÙŠÙ‘ÙŽØ§ÙƒÙŽ Ù†ÙŽØ³Ù’ØªÙŽØ¹ÙÙŠÙ†Ù\nØ§Ù‡Ù’Ø¯ÙÙ†ÙŽØ§ Ø§Ù„ØµÙ‘ÙØ±ÙŽØ§Ø·ÙŽ Ø§Ù„Ù’Ù…ÙØ³Ù’ØªÙŽÙ‚ÙÙŠÙ…ÙŽ\nØµÙØ±ÙŽØ§Ø·ÙŽ Ø§Ù„Ù‘ÙŽØ°ÙÙŠÙ†ÙŽ Ø£ÙŽÙ†Ù’Ø¹ÙŽÙ…Ù’ØªÙŽ Ø¹ÙŽÙ„ÙŽÙŠÙ’Ù‡ÙÙ…Ù’ ØºÙŽÙŠÙ’Ø±Ù Ø§Ù„Ù’Ù…ÙŽØºÙ’Ø¶ÙÙˆØ¨Ù Ø¹ÙŽÙ„ÙŽÙŠÙ’Ù‡ÙÙ…Ù’ ÙˆÙŽÙ„ÙŽØ§ Ø§Ù„Ø¶Ù‘ÙŽØ§Ù„Ù‘ÙÙŠÙ†ÙŽ","bot");
  }
  else if(q.includes("surah ikhlas")){
    add("Ù‚ÙÙ„Ù’ Ù‡ÙÙˆÙŽ Ø§Ù„Ù„Ù‘ÙŽÙ‡Ù Ø£ÙŽØ­ÙŽØ¯ÙŒ\nØ§Ù„Ù„Ù‘ÙŽÙ‡Ù Ø§Ù„ØµÙ‘ÙŽÙ…ÙŽØ¯Ù\nÙ„ÙŽÙ…Ù’ ÙŠÙŽÙ„ÙØ¯Ù’ ÙˆÙŽÙ„ÙŽÙ…Ù’ ÙŠÙÙˆÙ„ÙŽØ¯Ù’\nÙˆÙŽÙ„ÙŽÙ…Ù’ ÙŠÙŽÙƒÙÙ† Ù„Ù‘ÙŽÙ‡Ù ÙƒÙÙÙÙˆÙ‹Ø§ Ø£ÙŽØ­ÙŽØ¯ÙŒ","bot");
  }
  else if(q.includes("surah nas")){
    add("Ù‚ÙÙ„Ù’ Ø£ÙŽØ¹ÙÙˆØ°Ù Ø¨ÙØ±ÙŽØ¨Ù‘Ù Ø§Ù„Ù†Ù‘ÙŽØ§Ø³Ù\nÙ…ÙŽÙ„ÙÙƒÙ Ø§Ù„Ù†Ù‘ÙŽØ§Ø³Ù\nØ¥ÙÙ„ÙŽÙ°Ù‡Ù Ø§Ù„Ù†Ù‘ÙŽØ§Ø³Ù\nÙ…ÙÙ† Ø´ÙŽØ±Ù‘Ù Ø§Ù„Ù’ÙˆÙŽØ³Ù’ÙˆÙŽØ§Ø³Ù Ø§Ù„Ù’Ø®ÙŽÙ†Ù‘ÙŽØ§Ø³Ù\nØ§Ù„Ù‘ÙŽØ°ÙÙŠ ÙŠÙÙˆÙŽØ³Ù’ÙˆÙØ³Ù ÙÙÙŠ ØµÙØ¯ÙÙˆØ±Ù Ø§Ù„Ù†Ù‘ÙŽØ§Ø³Ù\nÙ…ÙÙ†ÙŽ Ø§Ù„Ù’Ø¬ÙÙ†Ù‘ÙŽØ©Ù ÙˆÙŽØ§Ù„Ù†Ù‘ÙŽØ§Ø³Ù","bot");
  }
  else if(q.includes("allah")){
    add("Allah is One. He has no partner. He is the Most Merciful ðŸ¤","bot");
  }
  else if(q.includes("hifz")){
    add("ðŸŒŸ MashaAllah! May Allah make your Hifz easy and bless your memory ðŸ¤²ðŸ“–","bot");
  }
  else{
    add("ðŸ•Œ Islamic Mode: Type 'Quran' or a Surah name.","bot");
  }
}

/* ===== UTIL ===== */
function toggleTheme(){
  document.body.classList.toggle("light");
}
function exportChat(){
  const b=new Blob([chatLog.join("\n")],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="chat.txt";
  a.click();
}
function logout(){
  location.reload();
}

add("Welcome! Select a mode and start chatting ðŸš€","bot");

/* âœ… SERVICE WORKER (FIXED PATH) */
if ("serviceWorker" in navigator) {
  window.addEventListener("load", () => {
    navigator.serviceWorker.register("./sw.js");
  });
}
</script>
</body>
</html>
