<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>StudyBuddy AI</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<!-- PWA -->
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#0b1225">

<style>
:root{
  --bg:#0b1225;
  --card:#111a33;
  --user:#2563eb;
  --bot:#1f2937;
  --text:#ffffff;
}
.light{
  --bg:#f3f4f6;
  --card:#ffffff;
  --user:#2563eb;
  --bot:#e5e7eb;
  --text:#000000;
}
body{
  margin:0;
  background:var(--bg);
  color:var(--text);
  font-family:Arial,Helvetica,sans-serif;
  display:flex;
  justify-content:center;
}
.app{
  width:420px;
  max-width:100%;
  height:100vh;
  display:flex;
  flex-direction:column;
}
.top,.mode-bar{
  padding:8px;
  display:flex;
  gap:6px;
}
button{
  flex:1;
  padding:8px;
  border:none;
  border-radius:8px;
  cursor:pointer;
}
.chat{
  flex:1;
  overflow-y:auto;
  padding:10px;
}
.msg{
  margin:6px 0;
  padding:10px 14px;
  border-radius:14px;
  max-width:85%;
  white-space:pre-wrap;
}
.user{background:var(--user);align-self:flex-end;}
.bot{background:var(--bot);align-self:flex-start;}
.bottom{
  display:flex;
  gap:6px;
  padding:10px;
}
.bottom input{
  flex:1;
  padding:10px;
  border-radius:10px;
  border:none;
}
.bottom button{
  background:#22c55e;
}
</style>
</head>

<body>
<div class="app">

<div class="top">
  <button onclick="toggleTheme()">ðŸŒ—</button>
  <button onclick="exportChat()">â¬‡</button>
  <button onclick="location.reload()">ðŸ”„</button>
</div>

<div class="mode-bar">
  <button onclick="setMode('chat')">ðŸ’¬</button>
  <button onclick="setMode('math')">âž—</button>
  <button onclick="setMode('games')">ðŸŽ®</button>
  <button onclick="setMode('quiz')">ðŸ§ </button>
  <button onclick="setMode('islam')">ðŸ•Œ</button>
</div>

<div class="chat" id="chat"></div>

<div class="bottom">
  <input id="input" placeholder="Type here..." onkeydown="if(event.key==='Enter')send()">
  <button onclick="send()">â–¶</button>
</div>

</div>

<script>
let mode="chat";
let chatLog=[];
const chat=document.getElementById("chat");
let userName=localStorage.getItem("sb_name")||"";

const quran=[
  {s:"Ikhlas 112:1",t:"Say: He is Allah, the One."},
  {s:"Baqarah 2:38",t:"Guidance will come to you from Me."},
  {s:"Rahman 55:13",t:"Which of the favors of your Lord will you deny?"},
  {s:"Isra 17:82",t:"The Quran is healing and mercy for believers."}
];

function add(text,cls){
  const d=document.createElement("div");
  d.className="msg "+cls;
  d.innerText=text;
  chat.appendChild(d);
  chat.scrollTop=chat.scrollHeight;
  chatLog.push((cls==="user"?"User: ":"AI: ")+text);
}

function setMode(m){
  mode=m;
  add("Mode: "+m.toUpperCase(),"bot");
}

function send(){
  const i=document.getElementById("input");
  const t=i.value.trim();
  if(!t) return;
  i.value="";
  add(t,"user");

  if(mode==="math") math(t);
  else if(mode==="games") games();
  else if(mode==="quiz") quiz();
  else if(mode==="islam") islam(t);
  else chatAI(t);
}

/* CHAT AI */
function chatAI(q){
  q=q.toLowerCase();

  if(q.startsWith("my name is")){
    userName=q.replace("my name is","").trim();
    localStorage.setItem("sb_name",userName);
    add("Nice to meet you, "+userName+" ðŸ˜Š","bot");
  }
  else if(q.includes("who are you"))
    add("I am StudyBuddy AI, your smart learning companion.","bot");

  else if(q.includes("what can you do"))
    add(
`I can help you with:
â€¢ Smart chatting
â€¢ Math solving
â€¢ Quizzes
â€¢ Games
â€¢ Quran & Islam
â€¢ Horror stories`,
"bot");

  else if(q.includes("your name"))
    add("My name is StudyBuddy AI.","bot");

  else if(q.includes("horror"))
    add(horrorStory(),"bot");

  else if(q.includes("hello")||q.includes("hi"))
    add("Assalamu Alaikum "+(userName||"")+" ðŸŒ™","bot");

  else
    add("I'm thinking ðŸ¤” Tell me more.","bot");
}

/* MATH */
function math(q){
  try{
    if(!/^[0-9+\-*/(). ]+$/.test(q)){
      add("Only math allowed.","bot");return;
    }
    add("Answer: "+Function("return "+q)(),"bot");
  }catch{add("Math error.","bot");}
}

/* GAMES */
function games(){
  const g=[
    "ðŸŽ² Guess a number from 1â€“10",
    "ðŸ§  Riddle: What has keys but no locks?",
    "ðŸŽ¯ Mental math: 14 Ã— 7?"
  ];
  add(g[Math.floor(Math.random()*g.length)],"bot");
}

/* QUIZ */
function quiz(){
  const q=[
    "ðŸ§  Capital of Pakistan?",
    "ðŸ•Œ How many daily prayers?",
    "ðŸ“ 8 Ã— 9 = ?"
  ];
  add(q[Math.floor(Math.random()*q.length)],"bot");
}

/* ISLAM + QURAN SEARCH */
function islam(q){
  q=q.toLowerCase();
  const found=quran.find(v=>q.includes(v.s.split(" ")[0].toLowerCase()));
  if(found)
    add("ðŸ“– "+found.s+": "+found.t,"bot");
  else
    add(quran[Math.floor(Math.random()*quran.length)].t,"bot");
}

/* HORROR */
function horrorStory(){
return `
ðŸ‘» HORROR STORY ðŸ‘»

At 3:17 AM, a message came:
"Why did you leave me?"

The sender was his own number.

Then another message:
"I'm behind you."

The room was empty.

But the mirrorâ€¦
was smiling.
`;
}

/* UTIL */
function toggleTheme(){document.body.classList.toggle("light");}

function exportChat(){
  const b=new Blob([chatLog.join("\n")],{type:"text/plain"});
  const a=document.createElement("a");
  a.href=URL.createObjectURL(b);
  a.download="studybuddy-chat.txt";
  a.click();
}

add("Welcome to StudyBuddy AI ðŸš€","bot");

if("serviceWorker" in navigator){
  navigator.serviceWorker.register("sw.js");
}
</script>
</body>
</html>
